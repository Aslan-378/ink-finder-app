<%= render 'navbar-dashboard' %>

<div class="main-dashboard-container">
  <div class="user-welcome">
    <div class="user-avatar">
      <% if current_user.avatar.present? %>
        <%= cl_image_tag current_user.avatar.key, class: "home-page__avatar"%>
      <% else %>
        <img src="https://res.cloudinary.com/dimly1skf/image/upload/v1598905968/White-and-Red-Modern-Technology-Gaming-Logo_gjja8o_jkuqil.png" class="home-page__avatar">
      <% end %>
    </div>
    <div class="user-intro">
      <h1>Hi, <strong><%= current_user.first_name %>!</strong></h1>
      <p>Welcome back!</p>
    </div>
  </div>
  <div class="bookings-container">
    <div class="upcoming-bookings-container">
      <h3><i class="far fa-check-circle"></i></i> Upcoming Bookings</h3>
      <div class="column-top">
        <p>Client</p>
        <p>Date</p>
        <p>Price</p>
        <p>Body part</p>
        <p>Size</p>
        <p>More info</p>
      </div>
      <div class="upcoming-bookings-list">
        <% if current_user.bookings.confirmed.count == 0 %>
          <span class="booking-card__no">Currently no confirmed bookings</span>
        <% else %>
          <% current_user.bookings.confirmed.each do |b| %>
            <div class="confirmed-booking-details">
                <p><%= b.request.name %></p>
              <div class="confirmed-booking-date">
                <p><%= b.date.strftime("%I:%M%p") %></p>
                <p><%= b.date.strftime("%d/%m/%y") %></p>
              </div>
              <p>£<%= b.price %></p>
              <p><%= b.request.body_part %></p>
              <p><%= b.request.size %>"</p>
              <%= link_to user_bookings_path(current_user) do %>
                <i class="far fa-plus-square"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="pending-bookings-container">
      <h3><i class="far fa-clock"></i>  Pending Client Confirmation</h3>
      <div class="column-top">
        <p>Client</p>
        <p>Date</p>
        <p>Price</p>
        <p>Body part</p>
        <p>Size</p>
        <p>More info</p>
      </div>
      <div class="upcoming-bookings-list">
        <% if current_user.bookings.unconfirmed.count == 0 %>
          <span class="booking-card__no">Currently no unconfirmed bookings</span>
        <% else %>
          <% current_user.bookings.unconfirmed.each do |b| %>
            <div class="confirmed-booking-details">
                <p><%= b.request.name %></p>
              <div class="confirmed-booking-date">
                <p><%= b.date.strftime("%I:%M%p") %></p>
                <p><%= b.date.strftime("%d/%m/%y") %></p>
              </div>
              <p>£<%= b.price %></p>
              <p><%= b.request.body_part %></p>
              <p><%= b.request.size %>"</p>
              <%= link_to user_bookings_path(current_user) do %>
                <i class="far fa-plus-square"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="contacts-container">
    <div class="requests-container">
      <h3><i class="fas fa-tasks"></i>  Requests</h3>
      <div class="column-top">
        <p>Client</p>
        <p>Pictures</p>
        <p>Body part</p>
        <p>Size</p>
        <p>description</p>
        <p>More info</p>
      </div>
      <div class="upcoming-bookings-list">
        <% if current_user.bookings.unconfirmed.count == 0 %>
          <span class="booking-card__no">Currently no unconfirmed bookings</span>
        <% else %>
          <% current_user.bookings.unconfirmed.each do |b| %>
            <div class="confirmed-booking-details">
              <p><%= b.request.name %></p>
              <p><%= b.request.body_part %></p>
              <p><%= b.request.size %>"</p>
              <p><%= b.request.description %> </p>
              <%= link_to " ☞ See More", user_bookings_path(current_user) %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="messages-container">
      <div class="messages-card__container">
        <h3 class="messages-card__title"><i class="fas fa-inbox"></i>  Inbox</h3>
        <div class="message-cards">
          <% current_user.requests.accepted.each do |r| %>
              <% if r.chatroom.present? %>
                  <%= link_to request_chatroom_path(r, r.chatroom.id), class: "message-card" do %> 
                      <span class="message-card__name"><%= r.chatroom.name %></span>
                      <span class="message-card__content"><%= r.chatroom.messages.last.content %></span>
                  <% end %>
              <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
